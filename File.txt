import cv2
import numpy as np

# Настройки камеры и размера экрана
CAMERA_IP = "http://192.168.31.40:4747/video"
PROJECTION_WIDTH = 1920
PROJECTION_HEIGHT = 1200

# Инициализация видеопотока камеры
cap = cv2.VideoCapture(CAMERA_IP)

if not cap.isOpened():
    print("Не удалось подключиться к камере.")
    exit()

# Калибровочные точки для отображения на проекторе
# (это пример, точки нужно будет распознать вручную по ходу теста)
calibration_points = [(100, 100), (1800, 100), (1800, 1100), (100, 1100)]

def draw_calibration_points(image):
    """
    Отображаем калибровочные точки на изображении.
    """
    for point in calibration_points:
        cv2.circle(image, point, 10, (0, 255, 0), -1)  # Рисуем зелёную точку

def calibrate():
    """
    Основная логика калибровки.
    """
    while True:
        ret, frame = cap.read()
        if not ret:
            break

        frame = cv2.resize(frame, (PROJECTION_WIDTH, PROJECTION_HEIGHT))

        # Чёрный фон и вывод точек
        black_image = np.zeros((PROJECTION_HEIGHT, PROJECTION_WIDTH, 3), dtype=np.uint8)

        draw_calibration_points(black_image)  # Отображаем калибровочные точки

        # Отображаем изображения на экране компьютера
        cv2.imshow("Проектор - Калибровка", black_image)

        key = cv2.waitKey(1) & 0xFF

        if key == ord('q'):  # Если нажать 'q' - выйти из цикла
            break
        if key == ord('r'):  # Если нажать 'r' - повторить калибровку
            print("Перезапуск калибровки.")
            continue

    cap.release()
    cv2.destroyAllWindows()

if __name__ == "__main__":
    calibrate()
